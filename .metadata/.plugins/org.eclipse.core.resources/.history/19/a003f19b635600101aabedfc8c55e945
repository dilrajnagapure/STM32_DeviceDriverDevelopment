/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include "stm32f4xx.h"
#include "stm32f4xx_gpio_driver.h"
#include "stm32f4xx_i2c_driver.h"
#include "stm32f4xx_spi_driver.h"
#if !defined(__SOFT_FP__) && defined(__ARM_FP)
  #warning "FPU is not initialized, but the project is compiling for an FPU. Please initialize the FPU before use."
#endif
extern void initialise_monitor_handles(void);
uint8_t toggle = 0;
void button_interrupt_program();
void led_blinking();
void button_read_polling();
void spi_write_read_polling(void);
//void i2c_write_read_interrupt(void);
int main(void)
{
	//initialise_monitor_handles();
	//printf("Hello Dilraj\n");

	spi_write_read_polling();

	led_blinking();

	while(1)
	{;
	}
}

SPI_Handle_t spi1;
uint8_t Txbuffer[]={0x0,0x0,'X','Y','Z'},Rxbuffer[]={0x0,0x0,0,0,0,0};
void i2c_write_read_interrupt(void)
{
	GPIO_Handle_t SPIPins;
	I2CPins.pvGPIOx = GPIOB;
	I2CPins.GPIO_PinConfg.pinMode = GPIO_ALT_FUNC;
	I2CPins.GPIO_PinConfg.pinOPType = GPIO_PUSHPULL;
	I2CPins.GPIO_PinConfg.pinPuPd = GPIO_NO_PUPD;//GPIO_PULL_UP;GPIO_NO_PUPD
	I2CPins.GPIO_PinConfg.pinSpeed = GPIO_MEDIUM_SPEED;//GPIO_HIGH_SPEED;
	I2CPins.GPIO_PinConfg.pinAltFunMode = AF5_SPI_1_to_4;

	GPIO_PeriClkCtrl(GPIOB,ENABLE);
	//sck
	SPIPins.GPIO_PinConfg.pinNumber = PIN_NUMBER_5;//SCK pin D13
	GPIO_Init(&SPIPins);

	//MOSI
	SPIPins.GPIO_PinConfg.pinNumber = PIN_NUMBER_7;//MOSI pin D11
	GPIO_Init(&SPIPins);

	//initialize I2C configuration
	spi1.SPIConfig.SPI_BusConfig = SPI_SIMPLEX;
	spi1.SPIConfig.SPI_CPHA = SPI_CPHA_LOW;
	spi1.SPIConfig.SPI_CPOL = SPI_CPOL_LOW;
	spi1.SPIConfig.SPI_DFF = SPI_DFF_8BIT;
	spi1.SPIConfig.SPI_DeviceMode = SPI_MODE_MASTER;
	spi1.SPIConfig.SPI_SSM = SPI_SSM_DISABLE;
	spi1.SPIConfig.SPI_SclkSpeed = SPI_BAUDRATE_FPCLK_2 ;

	SPI_Init(&spi1);

	// Enable IRQ configuration
	//I2C_IRQInterruptConfig(IRQ_NO_I2C1_EV, SET);
	//I2C_IRQInterruptConfig(IRQ_NO_I2C1_ER, SET);

	I2C_MasterSendDataIT(&i2c1, Txbuffer, 5, 0x50);
	for(uint32_t i=0;i<1000;i++);
}
void led_blinking()
{
	GPIO_Handle_t led;
	led.pvGPIOx = GPIOA;
	led.GPIO_PinConfg.pinMode = GPIO_OUTPUT;
	led.GPIO_PinConfg.pinOPType = GPIO_PUSHPULL;
	led.GPIO_PinConfg.pinPuPd = GPIO_NO_PUPD;
	led.GPIO_PinConfg.pinSpeed = GPIO_HIGH_SPEED;
	led.GPIO_PinConfg.pinAltFunMode = 0;
	led.GPIO_PinConfg.pinNumber = PIN_NUMBER_5;

	GPIO_PeriClkCtrl(GPIOA,ENABLE);
	GPIO_Init(&led);

	while(1)
	{
		GPIO_PinWrite(led.pvGPIOx,PIN_NUMBER_5,ENABLE);
		for(uint32_t i=0;i<100000;i++);

		GPIO_PinWrite(led.pvGPIOx,PIN_NUMBER_5,DISABLE);
		for(uint32_t i=0;i<100000;i++);

	}
}
